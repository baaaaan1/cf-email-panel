<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cloudflare Email Panel</title>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="/styles.css" rel="stylesheet">
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-container">
   <header class="header">
  <div class="header-left">
   <div class="logo"><span class="material-icons">email</span>
   </div>
   <div>
    <div class="header-title" id="panel-title">
     Cloudflare Email Panel
    </div>
    <div class="header-subtitle" id="welcome-message">
     Manage your email routing settings
    </div>
   </div>
  </div>
  <div class="flex gap-3">
   <button class="theme-toggle" id="btn-settings"> <span class="material-icons">settings</span> <span class="hidden sm:inline">Settings</span> </button>
   <button class="theme-toggle" id="btn-theme-toggle"> <span class="material-icons" id="theme-icon">dark_mode</span> <span id="theme-text" class="hidden sm:inline">Dark Mode</span> </button>
  </div>
   </header>
   <main class="main-content">
  <!-- Navigation Tabs -->
  <div class="nav-tabs">
   <button class="nav-tab active" data-target="view-dashboard"><span class="material-icons">dashboard</span> Dashboard</button>
   <button class="nav-tab" data-target="view-inbox"><span class="material-icons">inbox</span> Inbox</button>
  </div>

  <!-- Dashboard View -->
  <div id="view-dashboard" class="view-section active">
   <div class="stats-grid">
   <div class="stat-card">
    <div class="stat-header">
     <div class="stat-icon primary"><span class="material-icons">rule</span>
     </div>
     <div class="stat-title">
    Total Rules
     </div>
    </div>
    <div class="stat-value" id="stat-total-rules">0</div>
    <div class="stat-change positive"><span class="material-icons" style="font-size: 16px;">trending_up</span> updated</div>
   </div>
   <div class="stat-card">
    <div class="stat-header">
     <div class="stat-icon success"><span class="material-icons">verified</span>
     </div>
     <div class="stat-title">
    Active Rules
     </div>
    </div>
    <div class="stat-value" id="stat-active-rules">0</div>
    <div class="stat-change positive"><span class="material-icons" style="font-size: 16px;">trending_up</span> updated</div>
   </div>
  </div>
  <!-- API Status Panel -->
  <div class="panel" style="margin-bottom: 24px;">
  <div class="panel-header">
   <h2 class="panel-title">API Connection Status</h2><button class="btn btn-secondary" id="btn-check-status"> <span class="material-icons">refresh</span> Check Status </button>
   </div>
   <div class="panel-content">
    <div id="api-status" class="api-status-container">
     <div class="api-status-item">
    <div class="api-status-icon success"><span class="material-icons">cloud_done</span></div>
    <div class="api-status-info">
     <div class="api-status-title">Cloudflare API</div>
     <div class="api-status-desc">Connected • Last checked just now</div>
    </div>
    <div class="api-status-badge success">Online</div>
     </div>
     <div class="api-status-item">
    <div class="api-status-icon success"><span class="material-icons">email</span></div>
    <div class="api-status-info">
     <div class="api-status-title">Email Routing Service</div>
     <div class="api-status-desc">Active • Processing emails normally</div>
    </div>
    <div class="api-status-badge success">Active</div>
     </div>
    </div>
   </div>
  </div>
  <div class="panel">
   <div class="panel-header flex flex-wrap justify-between items-center gap-3">
    <h2 class="panel-title">Email Routing Rules</h2>
    <div class="flex items-center gap-3">
     <div class="relative hidden sm:block">
      <span class="material-icons absolute left-2 top-1/2 -translate-y-1/2 text-gray-400" style="font-size: 18px;">search</span>
      <input type="text" id="search-rules" placeholder="Search rules..." class="pl-8 pr-3 py-1.5 text-sm border rounded-md bg-transparent border-gray-300 focus:outline-none focus:border-blue-500 transition-colors">
     </div>
     <button class="btn btn-secondary" id="btn-add-rule"> <span class="material-icons">add_circle_outline</span> Add Rule </button>
    </div>
   </div>
   <div class="panel-content">
    <div id="rules-container"></div>
   </div>
  </div>
  </div>
  
  <!-- Inbox View -->
  <div id="view-inbox" class="view-section" style="display: none;">
   <div class="panel">
    <div class="panel-header">
     <h2 class="panel-title">Inbox</h2>
     <button class="btn btn-secondary" id="btn-refresh-inbox"> <span class="material-icons">refresh</span> Refresh </button>
    </div>
    <div class="panel-content">
     <div id="inbox-list" class="inbox-list">
      <div style="text-align: center; padding: 20px; color: var(--text-secondary-light);">Loading...</div>
     </div>
     <div class="pagination-controls" style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;"> <button class="btn btn-secondary" id="btn-inbox-prev" disabled>Previous</button> <button class="btn btn-secondary" id="btn-inbox-next" disabled>Next</button> </div>
    </div>
   </div>
  </div>

  </main>
  </div>
  <!-- Add/Edit Rule Modal -->
  <div class="modal-overlay" id="ruleModal">
   <div class="modal">I
  <div class="modal-header">
   <h2 class="modal-title" id="modalTitle">Add New Rule</h2><button class="modal-close" id="btn-modal-close"> <span class="material-icons">close</span> </button>
  </div>
  <div class="modal-body">
   <form id="ruleForm">
    <div class="form-group"><label class="form-label" for="fromEmail">From Email Address</label> <input type="email" id="fromEmail" class="form-input" placeholder="e.g., contact@example.com" required>
     <div class="form-help">The email address that will receive emails</div>
    </div>
    <div class="form-group"><label class="form-label" for="toEmail">Forward To</label> <input type="email" id="toEmail" class="form-input" placeholder="e.g., admin@company.com" required>
     <div class="form-help">Where emails should be forwarded</div>
    </div>
    <div class="form-group"><label class="form-label" for="ruleType">Rule Type</label> <select id="ruleType" class="form-select"> <option value="forward">Forward</option> <option value="drop">Drop (Delete)</option> <option value="worker">Send to Worker</option> </select>
     <div class="form-help">How this email should be handled</div>
    </div>
    <div class="form-group"><label class="form-label" for="priority">Priority</label> <select id="priority" class="form-select"> <option value="1">High (1)</option> <option value="5" selected>Normal (5)</option> <option value="10">Low (10)</option> </select>
     <div class="form-help">Lower numbers have higher priority</div>
    </div>
    <div class="form-group"><label class="form-label" for="description">Description (Optional)</label> <input type="text" id="description" class="form-input" placeholder="Brief description of this rule">
     <div class="form-help">Help identify this rule later</div>
    </div>
   </form>
  </div>
  <div class="modal-actions"><button type="button" class="btn btn-cancel" id="btn-cancel">Cancel</button> <button type="submit" form="ruleForm" class="btn" id="saveBtn"> <span class="material-icons">save</span> Save Rule </button>
  </div>
   </div>
  </div>
  <!-- Read Email Modal -->
  <div class="modal-overlay" id="emailModal">
   <div class="modal" style="max-width: 800px; width: 95%;">
    <div class="modal-header">
     <h2 class="modal-title" id="emailSubject">Subject</h2><button class="modal-close" id="btn-email-close"> <span class="material-icons">close</span> </button>
    </div>
    <div class="modal-body">
     <div class="email-meta">
      <div class="email-meta-row"> <strong id="emailSender">From: ...</strong> <span id="emailDate">Date</span> </div>
      <div class="email-meta-row" style="margin-top: 4px; font-size: 13px; color: var(--text-secondary-light);"> <span id="emailRecipient">To: ...</span> </div>
     </div>
     <div class="email-content-tabs"> <button class="btn btn-secondary active" id="btn-view-html" style="padding: 4px 12px; font-size: 12px;">HTML</button> <button class="btn btn-secondary" id="btn-view-text" style="padding: 4px 12px; font-size: 12px;">Text</button> </div>
     <div id="emailBodyContainer" class="email-body-container"></div>
    </div>
    <div class="modal-actions" style="justify-content: space-between;"> <button type="button" class="btn" id="btn-email-delete" style="background-color: var(--error);"> <span class="material-icons">delete</span> Delete </button> <button type="button" class="btn btn-cancel" id="btn-email-close-action">Close</button> </div>
   </div>
  </div>
  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
   <div class="modal">
    <div class="modal-header">
     <h2 class="modal-title">API Configuration</h2><button class="modal-close" id="btn-settings-close"> <span class="material-icons">close</span> </button>
    </div>
    <div class="modal-body">
     <form id="settingsForm">
      <div class="form-group"><label class="form-label" for="cfgAccountId">Account ID</label> <input type="text" id="cfgAccountId" class="form-input" placeholder="Cloudflare Account ID"></div>
      <div class="form-group"><label class="form-label" for="cfgZoneId">Zone ID</label> <input type="text" id="cfgZoneId" class="form-input" placeholder="Cloudflare Zone ID"></div>
      <div class="form-group"><label class="form-label" for="cfgApiToken">API Token</label> <input type="password" id="cfgApiToken" class="form-input" placeholder="Update API Token (leave empty to keep current)">
       <div class="form-help">Token requires Email Routing Read/Write permissions</div>
      </div>
     </form>
    </div>
    <div class="modal-actions"><button type="button" class="btn btn-cancel" id="btn-settings-cancel">Cancel</button> <button type="submit" form="settingsForm" class="btn"> <span class="material-icons">save</span> Save Config </button></div>
   </div>
  </div>
  <script src="/main.js" defer></script>
 </body>
</html>
